# Настройка IPSec over L2TP 
Server - Ubuntu 16.04

Client - Ubuntu 18.04

## Шаг 1. Установка StrongSwan и xl2tpd

Во-первых, мы установим StrongSwan, демон IPSec с открытым исходным кодом, который мы настроим как наш VPN-сервер. Мы также установим компонент инфраструктуры открытого ключа, чтобы мы могли создать центр сертификации.

Обновим пакеты и установим нужные компоненты:
```
apt-get install strongswan xl2tpd
```
    
## Шаг 2. Создание центра сертификации

Для идентификации клиентов серверу IKEv2 нужны сертификаты. Поэтому strongswan-pki поставляется с утилитой для генерирования центра сертификации и сертификатов сервера. Для начала создадим каталог для хранения всех этих компонентов. Заблокируем доступ к этому каталогу.

    mkdir -p ~/pki/{cacerts,certs,private}
    chmod 700 ~/pki
    
Теперь у нас есть отдельный каталог для сертификатов. Сгенерируем root ключ – 4096-битный RSA-ключ, с помощью которого вы сможете подписать root-сертификат.

    ipsec pki --gen --type rsa --size 4096 --outform pem > ~/pki/private/ca-key.pem
    
Теперь можно создать ЦС и использовать ключ для подписи сертификата root:

    ipsec pki --self --ca --lifetime 3650 --in ~/pki/private/ca-key.pem \
    --type rsa --dn "CN=VPN root CA" --outform pem > ~/pki/cacerts/ca-cert.pem

Мы можем изменить параметры флага —dn (distinguished name) и указать свою страну, организацию и имя.
